env:
  global:
    - CC_TEST_REPORTER_ID=cf96d355f42b24786c56534ca0ad370145c669bda3f7789a85e9fed326cd945c
    - GIT_COMMITTED_AT=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then git log -1 --pretty=format:%ct; else git log -1 --skip 1 --pretty=format:%ct; fi)
language: node_js
cache:
  yarn: true
  directories:
  - "node_modules"
node_js: '7'
jobs:
  include:
  - stage: lint
    script:
      - yarn lint
  - stage: unit tests
    before_script:
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    script: 
    - yarn test
    - if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT; fi
  - stage: deploy
    before_script: yarn build
    deploy:
      provider: firebase
      skip_cleanup: true
      on:
        branch: master
